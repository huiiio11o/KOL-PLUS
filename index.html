<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>KOL Manager Plus - Maillard Edition</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        maillard: {
                            // æ·ºè‰²æ¨¡å¼ï¼šç±³è‰²èˆ‡æ·ºç„¦ç³–
                            lightBg: '#fdf8f1',
                            lightCard: '#f5ebe0',
                            accent: '#c08b5c', // æ ¸å¿ƒç¾æ‹‰å¾·è‰²
                            text: '#4d3a33',
                            // æ·±è‰²æ¨¡å¼ï¼šæ·±å’–å•¡èˆ‡çƒ¤æ¼†è‰²
                            darkBg: '#1a120b',
                            darkCard: '#2c1e1a',
                            darkAccent: '#8b5e34'
                        }
                    }
                }
            }
        }
    </script>
    <style>
        .font-kol { font-family: 'Dancing Script', cursive; }
        .font-main { font-family: 'Noto Sans TC', sans-serif; }
        .glass {
            background: rgba(255, 255, 255, 0.4);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .dark .glass {
            background: rgba(44, 30, 26, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }
        .tab-active {
            box-shadow: 0 0 20px rgba(192, 139, 92, 0.5);
            color: #c08b5c;
            border-bottom: 2px solid #c08b5c;
        }
        /* éš±è—æ²è»¸ */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        /* æ¼‚æµ®æŒ‰éˆ•å‹•ç•« */
        .fab-press:active { transform: scale(0.9); }
        .slide-up { animation: slideUp 0.3s ease-out; }
        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
    </style>
</head>
<body class="font-main transition-colors duration-300 min-h-screen select-none" 
      :class="isDark ? 'bg-maillard-darkBg text-gray-200' : 'bg-maillard-lightBg text-maillard-text'" id="app">

    <!-- é ‚éƒ¨ Header -->
    <header class="sticky top-0 z-40 p-5 pb-2" :class="isDark ? 'bg-maillard-darkBg/80' : 'bg-maillard-lightBg/80'" style="backdrop-filter: blur(8px);">
        <h1 class="font-kol text-6xl tracking-[0.4em] w-full text-center py-4 mb-2 overflow-hidden whitespace-nowrap" 
            :class="isDark ? 'text-maillard-darkAccent' : 'text-maillard-accent'">
            KOL
        </h1>
        
        <div class="flex justify-between items-center px-1">
            <div>
                <span class="text-xs opacity-60">æ•¸æ“šç¸½è¨ˆ</span>
                <p class="text-lg font-bold leading-none">{{ kolList.length }} <span class="text-xs">ä½</span></p>
            </div>
            <button @click="toggleDarkMode" class="p-3 rounded-2xl glass flex items-center gap-2 transition-all active:scale-90">
                <i :data-lucide="isDark ? 'sun' : 'moon'" class="w-5 h-5"></i>
                <span class="text-xs font-bold">{{ isDark ? 'å¤ªé™½ï¼šæ·ºè‰²' : 'æœˆäº®ï¼šæ·±è‰²' }}</span>
            </button>
        </div>
    </header>

    <main class="px-4 pt-4 pb-32">
        <!-- ç¯©é¸å™¨ -->
        <section class="mb-6">
            <button @click="showFilter = !showFilter" 
                    class="w-full glass rounded-2xl p-4 flex justify-between items-center transition-all"
                    :class="selectedFilters.length > 0 ? 'border-maillard-accent border-2' : ''">
                <span class="flex items-center gap-2 font-bold uppercase tracking-widest text-sm">
                    <i data-lucide="sliders-horizontal" class="w-4 h-4"></i> 
                    ç¯©é¸åˆ†é¡ {{ selectedFilters.length > 0 ? `(${selectedFilters.length})` : '' }}
                </span>
                <i :data-lucide="showFilter ? 'chevron-up' : 'chevron-down'"></i>
            </button>
            
            <div v-if="showFilter" class="glass rounded-2xl mt-2 p-4 flex flex-wrap gap-2 slide-up">
                <div v-for="tag in allTags" :key="tag" class="relative group">
                    <button @click="toggleFilterTag(tag)"
                        :class="selectedFilters.includes(tag) ? 'bg-maillard-accent text-white shadow-lg' : 'bg-gray-200/50 dark:bg-white/10'"
                        class="pl-3 pr-8 py-2 rounded-xl text-xs font-medium transition-all">
                        #{{ tag }}
                    </button>
                    <!-- åˆªé™¤æ¨™ç±¤æŒ‰éˆ• -->
                    <button @click.stop="deleteGlobalTag(tag)" class="absolute right-1 top-1/2 -translate-y-1/2 p-1 text-red-400 opacity-60 hover:opacity-100">
                        <i data-lucide="x" class="w-3 h-3"></i>
                    </button>
                </div>
                <div v-if="allTags.length === 0" class="text-xs opacity-50 p-2">å°šç„¡æ¨™ç±¤ï¼Œè«‹æ–¼æ–°å¢ç¶²ç´…æ™‚å»ºç«‹</div>
            </div>
        </section>

        <!-- ç¶²ç´…åˆ—è¡¨ -->
        <div class="space-y-4">
            <div v-for="kol in filteredList" :key="kol.id" 
                 class="glass rounded-[32px] p-5 relative overflow-hidden transition-all border-l-8 active:scale-[0.98]"
                 :style="{ borderLeftColor: getTierColor(kol.tier) }">
                
                <div class="flex justify-between items-start mb-3">
                    <div class="flex-1">
                        <div class="flex items-center gap-2">
                            <h3 class="font-bold text-xl">{{ kol.name }}</h3>
                            <span class="text-[10px] px-2 py-0.5 rounded-lg bg-maillard-accent/20 text-maillard-accent font-bold">{{ kol.tier }}</span>
                        </div>
                        <p class="text-[10px] opacity-40 mt-1"><i data-lucide="clock" class="w-2.5 h-2.5 inline mr-1"></i>{{ kol.createdAt }}</p>
                    </div>
                    <div class="flex gap-1">
                        <button @click="editKOL(kol)" class="p-2 text-maillard-accent"><i data-lucide="edit-3" class="w-5 h-5"></i></button>
                        <button @click="deleteKOL(kol.id)" class="p-2 text-red-400"><i data-lucide="trash-2" class="w-5 h-5"></i></button>
                    </div>
                </div>

                <!-- å¹³å°è³‡è¨Š -->
                <div class="flex flex-wrap gap-4 mt-4">
                    <div v-for="(link, platform) in kol.platforms" :key="platform" v-show="link" class="flex items-center gap-1 bg-white/30 dark:bg-black/20 px-2 py-1 rounded-full">
                        <a :href="link" target="_blank" class="hover:scale-110 transition">
                            <img :src="getIcon(platform)" class="w-5 h-5 rounded-md">
                        </a>
                    </div>
                </div>

                <div class="mt-4 flex flex-wrap gap-1.5">
                    <span v-for="tag in kol.tags" :key="tag" class="text-[10px] border border-maillard-accent/30 text-maillard-accent px-2 py-0.5 rounded-md">#{{ tag }}</span>
                </div>
                
                <div v-if="kol.note" class="mt-4 p-3 rounded-2xl bg-black/5 dark:bg-white/5 text-xs italic opacity-70 leading-relaxed">
                    {{ kol.note }}
                </div>
            </div>
        </div>

        <!-- æŸ¥ç„¡è³‡æ–™ -->
        <div v-if="filteredList.length === 0" class="py-20 text-center opacity-30">
            <i data-lucide="search-x" class="w-12 h-12 mx-auto mb-2"></i>
            <p>æ²’æœ‰æ‰¾åˆ°ç¬¦åˆçš„ç¶²ç´…è³‡æ–™</p>
        </div>
    </main>

    <!-- æ¼‚æµ®æ–°å¢æŒ‰éˆ• (FAB) -->
    <button @click="openAddModal" 
            class="fixed bottom-24 right-6 w-16 h-16 bg-maillard-accent text-white rounded-full shadow-[0_10px_30px_rgba(192,139,92,0.4)] flex items-center justify-center z-50 fab-press transition-transform">
        <i data-lucide="plus" class="w-8 h-8"></i>
    </button>

    <!-- åº•éƒ¨å°è¦½åˆ— -->
    <nav class="fixed bottom-0 left-0 right-0 glass h-20 flex justify-around items-center px-10 rounded-t-[40px] z-[45]">
        <button @click="activeTab = 'list'; showFilter = false" class="flex flex-col items-center gap-1" :class="activeTab === 'list' ? 'text-maillard-accent' : 'opacity-40'">
            <i data-lucide="layout-grid" class="w-6 h-6"></i>
            <span class="text-[10px] font-bold">åå–®åˆ—è¡¨</span>
        </button>
        <button @click="openSyncModal" class="flex flex-col items-center gap-1" :class="activeTab === 'sync' ? 'text-maillard-accent' : 'opacity-40'">
            <i data-lucide="share-2" class="w-6 h-6"></i>
            <span class="text-[10px] font-bold">åŒæ­¥é›²ç«¯</span>
        </button>
    </nav>

    <!-- æ–°å¢/ç·¨è¼¯ æŠ½å±œå½ˆçª— -->
    <div v-if="showModal" class="fixed inset-0 z-[100] flex items-end justify-center bg-black/60 backdrop-blur-sm transition-opacity">
        <div class="w-full max-w-md bg-maillard-lightCard dark:bg-maillard-darkCard rounded-t-[40px] p-8 max-h-[92vh] overflow-y-auto no-scrollbar shadow-2xl slide-up">
            <div class="w-12 h-1.5 bg-gray-400/30 rounded-full mx-auto mb-8" @click="showModal = false"></div>
            
            <h2 class="text-2xl font-black mb-8 text-center tracking-widest">{{ isEditing ? 'ç·¨è¼¯è³‡æ–™' : 'æ–°å¢ç¶²ç´…åå–®' }}</h2>
            
            <div class="space-y-6">
                <!-- 1a. é€£çµèˆ‡è‡ªå‹•å¸¶å…¥åç¨± -->
                <div class="space-y-2">
                    <label class="text-xs font-bold opacity-60 px-1">å¹³å°ç¶²ç«™é€£çµ</label>
                    <div class="flex gap-2">
                        <input v-model="form.primaryLink" placeholder="è²¼ä¸Š IG / FB / YT é€£çµ..." class="flex-1 p-4 rounded-2xl dark:bg-maillard-darkBg bg-white border-none focus:ring-2 ring-maillard-accent outline-none text-sm">
                        <button @click="handleAutoFetch" class="bg-maillard-accent text-white px-5 rounded-2xl text-xs font-bold active:scale-95 transition-all">å¸¶å…¥åç¨±</button>
                    </div>
                </div>

                <div class="space-y-2">
                    <label class="text-xs font-bold opacity-60 px-1">ç¶²ç´…åç¨±</label>
                    <input v-model="form.name" placeholder="ä¾‹å¦‚ï¼šç¾æ‹‰å¾·å¥³å­©" class="w-full p-4 rounded-2xl dark:bg-maillard-darkBg bg-white border-none outline-none">
                </div>
                
                <div class="grid grid-cols-2 gap-4">
                    <div class="space-y-2">
                        <label class="text-xs font-bold opacity-60 px-1">ç­‰ç´šåˆ†é¡</label>
                        <select v-model="form.tier" class="w-full p-4 rounded-2xl dark:bg-maillard-darkBg bg-white border-none outline-none text-sm appearance-none">
                            <option value="å¯¶å¯¶ç¶²ç´…">ğŸ‘¶ å¯¶å¯¶ (1k-10k)</option>
                            <option value="ç¶²ç´…">ğŸ”¥ ç¶²ç´… (10k-30k)</option>
                            <option value="é‘½çŸ³ç´šç¶²ç´…">ğŸ’ é‘½çŸ³ (30k-50k)</option>
                        </select>
                    </div>
                    <div class="space-y-2">
                        <label class="text-xs font-bold opacity-60 px-1">ç²‰çµ²äººæ•¸</label>
                        <input v-model="form.followers" placeholder="äººæ•¸æ•¸å­—" class="w-full p-4 rounded-2xl dark:bg-maillard-darkBg bg-white border-none outline-none text-sm">
                    </div>
                </div>

                <!-- 1a & 1b. æ¨™ç±¤ç®¡ç† -->
                <div class="space-y-3">
                    <label class="text-xs font-bold opacity-60 px-1">åˆ†é¡æ¨™ç±¤ (å¤šé¸/æ–°å¢)</label>
                    <div class="flex flex-wrap gap-2">
                        <button v-for="tag in allTags" :key="tag" 
                            @click="toggleFormTag(tag)"
                            :class="form.tags.includes(tag) ? 'bg-maillard-accent text-white' : 'bg-gray-200 dark:bg-white/10'"
                            class="px-4 py-2 rounded-xl text-xs font-medium transition-all">
                            {{ tag }}
                        </button>
                        <div class="flex gap-1 items-center bg-maillard-accent/10 rounded-xl px-3 border border-dashed border-maillard-accent">
                            <input v-model="newTagName" placeholder="æ–°åˆ†é¡" class="text-xs py-2 w-16 bg-transparent outline-none">
                            <button @click="addNewTag" class="text-maillard-accent font-bold">+</button>
                        </div>
                    </div>
                </div>

                <!-- å…¶ä»–å¹³å° -->
                <div class="space-y-3">
                    <label class="text-xs font-bold opacity-60 px-1">æ•´åˆæ‰€æœ‰ç¤¾ç¾¤å¹³å° (é¸å¡«)</label>
                    <div class="grid grid-cols-2 gap-3">
                        <div v-for="(val, key) in form.platforms" :key="key" class="flex items-center gap-2 bg-white dark:bg-maillard-darkBg p-2 rounded-xl">
                            <img :src="getIcon(key)" class="w-5 h-5 grayscale opacity-50">
                            <input v-model="form.platforms[key]" :placeholder="key.toUpperCase()" class="bg-transparent text-[10px] outline-none w-full">
                        </div>
                    </div>
                </div>

                <div class="space-y-2">
                    <label class="text-xs font-bold opacity-60 px-1">å‚™è¨»æ¬„ä½</label>
                    <textarea v-model="form.note" placeholder="è¨˜éŒ„åˆä½œå…§å®¹æˆ–é¢¨æ ¼å‚™è¨»..." class="w-full p-4 rounded-2xl dark:bg-maillard-darkBg bg-white border-none outline-none h-24 text-sm"></textarea>
                </div>

                <div class="flex gap-4 pt-6">
                    <button @click="showModal = false" class="flex-1 p-5 rounded-[24px] bg-gray-200 dark:bg-white/10 font-bold">å–æ¶ˆ</button>
                    <button @click="saveKOL" class="flex-1 p-5 rounded-[24px] bg-maillard-accent text-white font-bold shadow-lg active:scale-95 transition-all">å®Œæˆå„²å­˜</button>
                </div>
            </div>
        </div>
    </div>

    <!-- åŒæ­¥è©¦ç®—è¡¨å½ˆçª— -->
    <div v-if="showSyncModal" class="fixed inset-0 z-[100] flex items-center justify-center bg-black/70 backdrop-blur-md p-6">
        <div class="w-full max-w-sm glass rounded-[40px] p-8 slide-up">
            <div class="w-16 h-16 bg-maillard-accent/20 text-maillard-accent rounded-full flex items-center justify-center mx-auto mb-6">
                <i data-lucide="upload-cloud" class="w-8 h-8"></i>
            </div>
            <h2 class="text-xl font-black mb-2 text-center">åŒæ­¥è‡³ Google</h2>
            <p class="text-[10px] mb-8 opacity-60 text-center tracking-widest uppercase">Select Active User</p>
            
            <div class="flex flex-col gap-3">
                <button v-for="u in ['åª½å’ª', 'Winnie', 'èŸ¬èªª']" :key="u" 
                    @click="syncUser = u"
                    :class="syncUser === u ? 'border-2 border-maillard-accent bg-maillard-accent text-white shadow-lg' : 'bg-white/10'"
                    class="p-5 rounded-2xl text-center font-bold transition-all active:scale-95">
                    {{ u }}
                </button>
            </div>
            <div class="flex gap-4 mt-10">
                <button @click="showSyncModal = false" class="flex-1 p-4 rounded-2xl bg-gray-200 dark:bg-white/10 text-xs">æš«æ™‚ä¸è¦</button>
                <button @click="submitToGoogleSheet" :disabled="!syncUser || isSyncing" class="flex-1 p-4 rounded-2xl bg-maillard-accent text-white font-bold disabled:opacity-30 text-xs">
                    {{ isSyncing ? 'ä¸Šå‚³ä¸­...' : 'ç¢ºèªä¸Šå‚³' }}
                </button>
            </div>
        </div>
    </div>

    <script>
        const { createApp, ref, computed, onMounted } = Vue;

        createApp({
            setup() {
                const isDark = ref(false);
                const showModal = ref(false);
                const showSyncModal = ref(false);
                const showFilter = ref(false);
                const isEditing = ref(false);
                const activeTab = ref('list');
                const isSyncing = ref(false);

                // æ ¸å¿ƒæ•¸æ“š
                const kolList = ref(JSON.parse(localStorage.getItem('kol_data_plus') || '[]'));
                const allTags = ref(JSON.parse(localStorage.getItem('kol_tags_plus') || '["è‚²å…’", "ç¾é£Ÿ", "ç¾å¦", "æ—…éŠ"]'));
                const selectedFilters = ref([]);
                
                const form = ref({
                    id: null,
                    name: '',
                    primaryLink: '',
                    tier: 'å¯¶å¯¶ç¶²ç´…',
                    followers: '',
                    tags: [],
                    platforms: { ig: '', fb: '', xhs: '', yt: '', tiktok: '', blog: '' },
                    note: '',
                    createdAt: ''
                });

                const newTagName = ref('');
                const syncUser = ref('');

                // é¡è‰²èˆ‡åœ–æ¨™
                const getTierColor = (tier) => {
                    const colors = { 'å¯¶å¯¶ç¶²ç´…': '#c08b5c', 'ç¶²ç´…': '#8b5e34', 'é‘½çŸ³ç´šç¶²ç´…': '#4d3a33' };
                    return colors[tier] || '#ccc';
                };

                const getIcon = (p) => {
                    const icons = {
                        ig: 'https://cdn-icons-png.flaticon.com/512/174/174855.png',
                        fb: 'https://cdn-icons-png.flaticon.com/512/733/733547.png',
                        xhs: 'https://is1-ssl.mzstatic.com/image/thumb/Purple126/v4/3d/8d/68/3d8d6892-2580-c081-9b1a-853f6068257d/AppIcon-0-0-1x_U007emarketing-0-0-0-7-0-0-sRGB-0-0-0-GLES2_U002c0-512MB-85-220-0-10.png/512x512bb.jpg',
                        yt: 'https://cdn-icons-png.flaticon.com/512/1384/1384060.png',
                        tiktok: 'https://cdn-icons-png.flaticon.com/512/3046/3046121.png',
                        blog: 'https://cdn-icons-png.flaticon.com/512/60/60736.png'
                    };
                    return icons[p];
                };

                const toggleDarkMode = () => {
                    isDark.value = !isDark.value;
                    document.documentElement.classList.toggle('dark');
                    setTimeout(() => lucide.createIcons(), 10);
                };

                const openAddModal = () => {
                    isEditing.value = false;
                    form.value = { id: Date.now(), name: '', primaryLink: '', tier: 'å¯¶å¯¶ç¶²ç´…', followers: '', tags: [], platforms: { ig: '', fb: '', xhs: '', yt: '', tiktok: '', blog: '' }, note: '', createdAt: '' };
                    showModal.value = true;
                    setTimeout(() => lucide.createIcons(), 50);
                };

                // 3. ç¶²ç´…è³‡è¨Šçš„éƒ¨åˆ†è‡ªå‹•å¸¶å…¥åç¨±
                const handleAutoFetch = () => {
                    if (!form.value.primaryLink) return alert('è«‹å…ˆè¼¸å…¥é€£çµ');
                    const url = form.value.primaryLink.toLowerCase();
                    
                    if (url.includes('instagram.com')) form.value.name = "IG å‰µä½œè€…";
                    else if (url.includes('facebook.com')) form.value.name = "FB ç²‰çµ²å°ˆé ";
                    else if (url.includes('youtube.com')) form.value.name = "Youtube é »é“";
                    else form.value.name = "æ–°ç¶²ç´…æˆå“¡";
                    
                    alert('å·²æ ¹æ“šé€£çµåµæ¸¬ä¸¦å¡«å…¥é è¨­åç¨±');
                };

                const saveKOL = () => {
                    if (!form.value.name) return alert('è«‹è¼¸å…¥ç¶²ç´…åç¨±');
                    
                    const duplicateIndex = kolList.value.findIndex(k => k.name === form.value.name && k.id !== form.value.id);
                    if (duplicateIndex !== -1) {
                        if (confirm(`ç™¼ç¾é‡è¤‡ï¼šå·²æœ‰ã€Œ${form.value.name}ã€ï¼Œæ˜¯å¦è¦åˆªé™¤èˆŠçš„ä¸€ç­†ä¸¦ä¿ç•™æ­¤æ–°è³‡æ–™ï¼Ÿ`)) {
                            kolList.value.splice(duplicateIndex, 1);
                        } else { return; }
                    }

                    if (!isEditing.value) {
                        const now = new Date();
                        form.value.createdAt = `${now.toLocaleDateString()} ${now.toLocaleTimeString()}`;
                        kolList.value.unshift({ ...form.value });
                    } else {
                        const idx = kolList.value.findIndex(k => k.id === form.value.id);
                        kolList.value[idx] = { ...form.value };
                    }

                    saveToLocal();
                    showModal.value = false;
                    setTimeout(() => lucide.createIcons(), 10);
                };

                const deleteKOL = (id) => {
                    if (confirm('ç¢ºå®šè¦ç§»é™¤é€™ä½ç¶²ç´…å—ï¼Ÿ')) {
                        kolList.value = kolList.value.filter(k => k.id !== id);
                        saveToLocal();
                    }
                };

                const editKOL = (kol) => {
                    isEditing.value = true;
                    form.value = JSON.parse(JSON.stringify(kol));
                    showModal.value = true;
                    setTimeout(() => lucide.createIcons(), 50);
                };

                const deleteGlobalTag = (tag) => {
                    if(confirm(`ç¢ºå®šè¦åˆªé™¤ã€Œ${tag}ã€é€™å€‹æ¨™ç±¤å—ï¼Ÿé€™æœƒå¾æ¨™ç±¤åº«ä¸­ç§»é™¤ã€‚`)) {
                        allTags.value = allTags.value.filter(t => t !== tag);
                        selectedFilters.value = selectedFilters.value.filter(t => t !== tag);
                        saveToLocal();
                    }
                };

                const toggleFilterTag = (tag) => {
                    if (selectedFilters.value.includes(tag)) {
                        selectedFilters.value = selectedFilters.value.filter(t => t !== tag);
                    } else {
                        selectedFilters.value.push(tag);
                    }
                };

                const toggleFormTag = (tag) => {
                    if (form.value.tags.includes(tag)) {
                        form.value.tags = form.value.tags.filter(t => t !== tag);
                    } else {
                        form.value.tags.push(tag);
                    }
                };

                const addNewTag = () => {
                    const t = newTagName.value.trim();
                    if (t && !allTags.value.includes(t)) {
                        allTags.value.push(t);
                        form.value.tags.push(t);
                        newTagName.value = '';
                        saveToLocal();
                    }
                };

                const saveToLocal = () => {
                    localStorage.setItem('kol_data_plus', JSON.stringify(kolList.value));
                    localStorage.setItem('kol_tags_plus', JSON.stringify(allTags.value));
                };

                const filteredList = computed(() => {
                    if (selectedFilters.value.length === 0) return kolList.value;
                    return kolList.value.filter(k => selectedFilters.value.every(f => k.tags.includes(f)));
                });

                const openSyncModal = () => {
                    activeTab.value = 'sync';
                    showSyncModal.value = true;
                    setTimeout(() => lucide.createIcons(), 50);
                };

                const submitToGoogleSheet = async () => {
                    if (kolList.value.length === 0) return alert('ç›®å‰æ²’æœ‰è³‡æ–™å¯ä»¥åŒæ­¥');
                    isSyncing.value = true;
                    const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzAFMdwbeGbh7FO-3HH638NSrDg8SXlTpnNIgKTdvmUM8MPN3g3ipqHLuPTXjCBTpg/exec'; 
                    
                    try {
                        // ä½¿ç”¨ No-CORS æ¨¡å¼é€²è¡Œå‚³é€ï¼ˆé‡å° Apps Script Web App å¸¸è¦‹è™•ç†ï¼‰
                        await fetch(SCRIPT_URL, {
                            method: 'POST',
                            mode: 'no-cors',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ user: syncUser.value, data: kolList.value })
                        });
                        
                        alert(`ã€${syncUser.value}ã€‘åŒæ­¥æˆåŠŸï¼è³‡æ–™å·²æ¨é€åˆ° Google Sheetã€‚`);
                        showSyncModal.value = false;
                        activeTab.value = 'list';
                    } catch (e) {
                        console.error(e);
                        alert('åŒæ­¥éç¨‹ç™¼ç”ŸéŒ¯èª¤ï¼Œè«‹æª¢æŸ¥ç¶²è·¯æˆ– Apps Script æ¬Šé™ã€‚');
                    } finally {
                        isSyncing.value = false;
                    }
                };

                onMounted(() => {
                    lucide.createIcons();
                });

                return {
                    isDark, showModal, showSyncModal, showFilter, isEditing, activeTab, isSyncing,
                    kolList, allTags, selectedFilters, form, newTagName, syncUser,
                    filteredList, toggleDarkMode, openAddModal, handleAutoFetch, 
                    saveKOL, deleteKOL, editKOL, toggleFilterTag, toggleFormTag, deleteGlobalTag,
                    addNewTag, getTierColor, getIcon, openSyncModal, submitToGoogleSheet
                };
            }
        }).mount('#app');
    </script>
</body>
</html>